@model Productoras.Models.UsuariosTipos

<div class="detalles_popups">
    @{ var i = 0; }
    @foreach (var categoriaItem in Model.UsuariosTiposCategorias)
    {
        i++;

        if (categoriaItem.activo_b == true && categoriaItem.tipoUsuario_xref == 1)
        {
            <div class="col-md-4">
                <div class="panel panel-default" style="min-height: 300px;">
                    <div class="panel-heading">@categoriaItem.nombre_c</div>
                    <div class="panel-body">
                        @foreach (var subcategoriaItem in categoriaItem.UsuariosTiposSubcategorias)
                        {
                            if (subcategoriaItem.activo_b == true && subcategoriaItem.UsuariosTiposCategorias.tipoUsuario_xref == 1)
                            {
                                <div class="col-md-12 margen_arriba_5">
                                    @if (categoriaItem.UsuariosTipos.Usuarios.First().UsuariosTecnico.First().UsuariosTecnicosSubcategorias.Where(s => s.subcategoria_xref == subcategoriaItem.id).Count() > 0)
                                    {
                                        <button id="btnSubcategoria_@subcategoriaItem.id" class="btn btn-info btnCategoria itemSeleccionado" style="width: 100%;" onclick="toggleSubcategoria(@subcategoriaItem.id);">@subcategoriaItem.nombre_c</button>
                                    }
                                    else
                                    {
                                        <button id="btnSubcategoria_@subcategoriaItem.id" class="btn btn-default btnCategoria" style="width: 100%;" onclick="toggleSubcategoria(@subcategoriaItem.id);">@subcategoriaItem.nombre_c</button>
                                    }
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>

        }
    }
</div>
<script>

    function toggleSubcategoria(idSubcategoria) {
        var totalSeleccionados = 0;
        var btnSubcategoria = $('#btnSubcategoria_' + idSubcategoria);
        if (btnSubcategoria.hasClass('itemSeleccionado')) {
            totalSeleccionados - 1;
            btnSubcategoria.removeClass('btn-info');
            btnSubcategoria.removeClass('itemSeleccionado');
            btnSubcategoria.addClass('btn-default');
            borrarSubcategoria(idSubcategoria);
        }

        else if (btnSubcategoria.hasClass('itemSeleccionado') == false) {
            $('.itemSeleccionado').each(function () {
                totalSeleccionados++;
            });

            if (totalSeleccionados <= 4) {
                $.ajax({
                    data: { idSubcategoria: idSubcategoria },
                    url: "PerfilAddCompetencia",
                    method: "POST",
                    success: function (data) {
                        $('#btnSubcategoria_' + idSubcategoria).removeClass('btn-default');
                        $('#btnSubcategoria_' + idSubcategoria).addClass('btn-info');
                        $('#btnSubcategoria_' + idSubcategoria).addClass('itemSeleccionado');
                        $('#lstSubcategorias').append("<li id='subcategoria_" + idSubcategoria + "'>" + data + " <i class='fa fa-trash pull-right' onclick='borrarSubcategoria(" + idSubcategoria + ")'></i></li>");
                    }
                });

            }
            else if (totalSeleccionados > 4) {
                alert("Desmarca alguna categoría antes de selecionar otra.");
            }
        }
    }
</script>